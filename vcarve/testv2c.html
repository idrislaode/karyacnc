<body>
<canvas id=mycanv width=800 height=600></canvas>
<textarea id=gcode cols=200 rows=100>
</textarea>
<script>
function $(id) {
    return document.getElementById(id);
}
sqrt=Math.sqrt;
sqr=function(x){return x*x;}
paths=[[74.231,44.436,74.003,44.476,73.778,44.61,73.559,44.836,73.501,45.055,73.612,45.318,73.895,45.667,74.397,46.135,74.775,46.294,74.912,46.256,75.01,46.142,75.092,45.683,74.969,45.039,74.655,44.602,74.451,44.481,74.231,44.436],[84.492,43.432,85.431,44.553,86.185,45.615,86.438,46.181,86.622,46.835,86.827,48.606,86.979,53.909,87.072,54.632,87.127,54.799,87.189,54.822,87.375,54.522,87.58,53.993,88.012,52.448,88.394,50.605,88.623,48.879,88.642,47.103,88.419,45.339,87.948,43.564,87.228,41.763,86.311,39.79,84.492,43.432],[93.744,119.339,93.455,119.401,93.212,119.579,93.021,119.846,92.888,120.182,92.82,120.975,92.897,121.388,93.055,121.781,93.398,122.286,93.584,122.422,93.797,122.481,94.364,122.376,95.214,121.984,95.95,121.51,96.175,121.294,96.257,121.125,96.179,120.899,95.964,120.627,95.269,120.039,94.439,119.545,94.056,119.394,93.744,119.339],[108.241,111.727,107.972,111.927,107.71,112.412,107.417,113.233,106.874,115.292,106.778,116.078,106.791,116.759,106.979,117.007,107.46,117.373,109.008,118.263,110.626,119.029,111.465,119.348,111.672,119.282,111.868,119.087,112.225,118.352,112.515,117.202,112.72,115.704,112.929,113.479,108.549,111.764,108.241,111.727],[95.647,84.197,95.381,84.94,95.001,86.425,94.657,87.999,94.502,89.004,94.615,89.644,94.78,89.923,95.034,90.188,95.853,90.716,97.164,91.31,99.481,92.176,99.624,92.092,99.784,91.846,100.124,90.974,100.447,89.747,100.692,88.359,100.908,86.712,98.351,85.379,96.503,84.483,95.906,84.245,95.647,84.197],[102.758,81.673,102.59,81.989,102.393,82.588,101.98,84.272,101.671,85.976,101.605,86.604,101.625,86.955,101.884,87.262,102.429,87.676,104.056,88.622,104.964,89.054,105.681,89.32,106.239,89.403,106.67,89.281,107.004,88.934,107.271,88.345,107.736,86.361,108.176,84.018,106.888,83.473,103.253,81.78,102.758,81.673],[96.586,76.75,96.433,76.855,96.233,77.251,95.769,78.613,95.364,80.239,95.19,81.53,95.244,82.132,95.459,82.581,95.916,82.973,96.692,83.411,98.01,84.026,99.074,84.431,99.827,84.504,100.142,84.432,100.379,84.289,100.773,83.385,101.291,81.705,101.707,80.062,101.802,79.51,101.786,79.274,99.254,78.049,96.586,76.75],[50.782,58.137,50.433,58.501,49.416,59.867,48.241,61.694,47.231,63.51,46.44,65.312,45.907,67.004,45.627,68.563,45.6,69.97,45.825,71.201,46.032,71.745,46.301,72.237,46.632,72.678,47.026,73.06,47.481,73.383,47.997,73.646,48.91,73.923,49.317,73.951,49.703,73.9,50.082,73.768,50.464,73.552,51.275,72.863,51.878,72.108,52.313,71.281,52.513,70.551,52.503,70.273,52.405,70.08,52.046,70.067,51.045,70.473,50.679,70.51,50.301,70.403,49.847,70.147,49.045,69.504,48.465,68.761,48.108,67.9,47.973,66.91,48.059,65.767,48.366,64.46,48.896,62.97,50.644,59.073,50.976,58.066,50.782,58.137],[95.561,112.353,95.225,112.717,94.707,113.559,93.374,116.107,92.104,118.872,91.665,119.985,91.448,120.733,91.349,121.902,91.447,122.916,91.737,123.766,92.218,124.437,92.557,124.699,92.946,124.864,93.375,124.938,93.829,124.928,94.788,124.68,95.746,124.173,96.627,123.459,97.35,122.588,97.841,121.613,97.975,121.1,98.021,120.584,97.962,120.146,97.799,119.653,97.225,118.61,96.429,117.639,95.989,117.243,95.101,116.646,94.813,116.36,94.68,116.08,94.703,115.817,95.127,114.622,95.454,113.481,95.619,112.643,95.621,112.411,95.561,112.353],[87.651,82.818,87.245,82.889,85.688,83.56,82.845,85.02,77.071,88.102,73.38,90.218,72.207,90.982,71.424,91.585,70.985,92.057,70.848,92.423,70.91,92.936,71.088,93.197,71.374,93.196,72.441,92.467,73.901,91.63,79.322,88.747,85.372,85.595,86.48,84.977,87.234,84.452,87.684,83.974,87.885,83.504,87.927,83.138,87.861,82.904,87.651,82.818],[74.774,42.433,74.384,42.47,73.982,42.609,73.578,42.848,73.185,43.183,72.807,43.614,72.405,44.202,72.125,44.752,71.969,45.269,71.934,45.756,72.022,46.22,72.235,46.663,72.57,47.089,73.031,47.502,74.149,48.377,74.16293649671064,48.37520984171175,74.149,48.377,73.207,49.613,71.8,51.145,69.745,53.082,65.953,56.447,65.379,57.002,65.093,57.375,65.065,57.572,65.279,57.601,65.697,57.455,66.29,57.15,67.907,56.077,69.633,54.647,71.527,52.855,73.255,51.035,74.818,49.081,75.121,48.88,75.474,48.892,76.727,49.324,77.03,49.351,77.23,49.306,77.421,49.129,77.53,48.895,77.519,48.314,77.229,47.674,76.69,47.092,76.134,46.551,76.012,46.344,76.021,46.212,76.135,45.989,76.202,45.621,76.206,44.642,76.061,43.633,75.939,43.23,75.787,42.954,75.485,42.672,75.144,42.5,74.774,42.433],[48.043,76.3,47.223,76.352,46.556,76.549,45.902,76.96,45.125,77.645,44.488,78.353,43.804,79.283,43.153,80.315,42.615,81.331,42.065,82.569,41.793,83.396,41.764,83.981,41.943,84.488,42.484,85.386,43.041,86.027,43.617,86.411,44.214,86.541,44.923,86.615,45.094,86.712,45.148,86.857,45.086,87.055,44.902,87.313,43.275,88.898,42.677,89.668,42.396,90.303,42.381,90.563,42.454,90.777,42.601,90.96,42.792,91.061,43.055,91.071,43.419,90.977,44.567,90.446,48.912,88.047,51.958,86.55,53.365,85.562,54.551,84.451,55.006,83.892,55.337,83.358,55.753,82.47,55.989,81.787,56.046,81.304,55.922,81.021,55.616,80.94,55.128,81.063,54.462,81.387,52.141,82.805,50.762,83.524,49.994,83.833,49.353,83.937,48.601,83.841,47.497,83.547,45.948,82.958,45.346,82.635,44.968,82.343,44.671,81.982,44.577,81.725,44.69,81.485,45.011,81.175,45.814,80.661,46.648,80.386,47.011,80.352,47.303,80.391,47.495,80.508,47.651,80.972,47.887,81.153,48.227,81.25,48.628,81.265,49.051,81.201,49.453,81.061,49.794,80.849,50.03,80.565,50.194,80.153,50.306,79.643,50.384,78.491,50.272,77.413,50.145,77.001,49.971,76.724,49.687,76.558,49.228,76.424,48.043,76.3],[72.134,121.786,71.725,121.802,71.316,121.904,70.919,122.095,70.544,122.388,70.203,122.785,69.842,123.429,69.375,124.458,68.361,127.107,67.481,129.55,66.982,130.716,66.98651591362973,130.73054060113168,66.982,130.716,66.805,130.604,66.484,130.087,64.709,126.319,63.761,124.833,62.798,123.741,62.326,123.352,61.865,123.071,61.425,122.899,61.009,122.843,60.621,122.901,60.27,123.08,59.959,123.381,59.697,123.808,59.488,124.36,59.337,125.045,59.283,125.68,59.382,126.19,59.674,126.672,60.199,127.226,60.708,127.652,61.195,127.942,61.656,128.094,62.481,128.121,62.877,128.285,63.266,128.595,63.654,129.052,64.038,129.656,64.417,130.407,66.108,134.903,66.254,135.076,66.409,135.1,66.586,134.942,66.795,134.577,67.365,133.122,68.235,130.508,69.381,127.304,69.882,126.137,70.245,125.481,70.558,125.139,70.883,124.89,71.212,124.735,71.543,124.674,71.865,124.709,72.175,124.836,72.468,125.061,72.739,125.377,73.257,126.117,73.841,125.239,74.087,124.777,74.221,124.324,74.256,123.887,74.199,123.471,74.062,123.086,73.855,122.736,73.275,122.178,72.535,121.848,72.134,121.786],[117.572,67.213,117.321,68.026,116.411,72.219,117.881,73.472,121.044,76.393,124.866,80.237,128.467,84.087,129.909,85.73,130.964,87.03,132.505,89.193,133.864,91.355,135.039,93.522,136.035,95.694,136.85,97.878,137.488,100.075,137.949,102.291,138.235,104.526,138.38,106.814,138.411,109.089,138.326,111.349,138.126,113.594,137.81,115.826,137.81,115.826,137.377,118.049,136.829,120.259,136.829,120.259,136.166,122.459,135.383,124.648,134.485,126.829,133.471,129,132.339,131.164,131.087,133.321,129.72,135.472,128.234,137.616,124.875,142.062,123.984,143.329,123.923,143.482,123.967,143.511,124.327,143.21,125.872,141.511,128.056,138.899,130.315,136.026,133.296,131.862,134.543,129.925,135.646,128.051,136.62,126.217,137.478,124.394,138.237,122.556,138.908,120.68,140.092,116.72,140.952,112.929,141.258,111.092,141.484,109.289,141.628,107.522,141.692,105.784,141.673,104.076,141.574,102.395,141.394,100.736,141.132,99.102,140.789,97.488,140.365,95.891,139.86,94.309,139.273,92.741,138.434,90.876,137.369,88.88,136.118,86.807,134.716,84.713,134.716,84.713,133.206,82.651,131.622,80.677,131.622,80.677,130.004,78.842,127.621,76.39,127.304,75.886,127.411,75.78,127.714,75.688,129.706,75.523,130.01,75.434,130.123,75.325,129.594,74.843,128.196,73.846,123.939,71.021,119.636,68.319,118.182,67.474,117.572,67.213],[114.729,98.697,114.72941961721902,98.69800676894772,114.729,98.697,113.879,98.998,113.072,99.174,112.305,99.223,111.584,99.147,110.901,98.943,110.259,98.613,109.656,98.156,109.09,97.574,108.682,97.039,108.522,96.572,108.598,95.956,108.891,94.97,109.209,93.684,109.25,93.239,109.199,93.006,108.994,92.943,108.707,93.058,107.952,93.741,107.059,94.906,105.651,97.279,105.108,98.068,104.53,98.776,103.925,99.399,103.296,99.935,102.647,100.385,101.981,100.745,101.307,101.015,100.625,101.193,99.941,101.279,99.259,101.268,98.585,101.161,97.921,100.958,97.273,100.655,96.645,100.252,96.042,99.746,95.314,99.019,94.953,98.434,94.86,97.721,95.026,95.21,94.94,94.506,94.801,94.463,94.547,94.523,93.601,94.997,89.27,97.745,87.732,98.688,86.184,99.505,84.61,100.198,82.998,100.772,81.331,101.232,79.599,101.581,77.788,101.824,75.884,101.965,73.846,102.032,72.393,101.996,71.301,101.842,70.355,101.553,69.446,101.168,68.607,100.729,67.835,100.237,67.128,99.69,66.482,99.081,65.894,98.412,65.362,97.68,64.882,96.879,64.252,95.629,63.723,94.34,63.276,92.927,62.894,91.304,62.561,89.391,62.561,89.391,62.261,87.104,60.888,72.637,60.888,72.637,60.444,69.163,59.934,65.987,59.335,62.962,58.618,59.939,57.758,56.776,56.729,53.325,56.043,51.325,55.414,49.94,55.129,49.492,54.869,49.219,54.635,49.122,54.429,49.212,54.102,50.064,53.567,51.858,52.884,54.326,54.138,58.35,55.411,62.658,55.887,64.677,56.324,67.008,57.283,73.812,58.691,85.477,59.372,90.361,60.179,94.785,61.026,98.333,61.437,99.647,61.825,100.586,62.744,102.049,64.008,103.618,65.4,105.048,66.696,106.09,67.819,106.672,69.166,107.188,70.516,107.493,72.079,107.649,73.804,107.659,75.632,107.533,77.508,107.273,79.379,106.885,81.189,106.377,82.883,105.754,85.155,104.693,87.492,103.423,89.582,102.124,91.115,100.977,92.001,100.249,92.474,99.948,92.47802632947682,99.93365631428802,92.474,99.948,92.674,100.355,93.18,102.454,93.631,103.469,94.233,104.373,94.233,104.373,94.966,105.148,95.812,105.78,96.75,106.25,97.766,106.546,98.839,106.649,98.839,106.649,99.803,106.598,100.695,106.445,101.527,106.187,102.297,105.819,103.02,105.338,103.696,104.742,104.333,104.024,104.938,103.185,106.386,101.015,106.553,101.076,106.916,101.371,108.791,103.255,109.491,103.796,110.182,104.139,110.95,104.335,111.626,104.405,112.341,104.4,113.781,104.187,115.069,103.744,115.598,103.452,116.011,103.121,116.391,102.654,116.726,102.072,117.255,100.622,117.598,98.898,117.752,97.033,117.711,95.149,117.472,93.383,117.032,91.857,116.734,91.227,116.384,90.705,115.715,89.884,115.287,90.944,114.819,92.456,114.658,93.861,114.693,94.514,114.803,95.131,114.99,95.709,115.802,97.25,115.918,97.599,115.922,97.87,115.812,98.09,115.581,98.286,114.729,98.697,114.72941961721902,98.69800676894772,114.729,98.697],[54.519,89.215,54.289,89.311,53.718,89.927,53.035,91.022,52.296,92.473,51.552,94.173,50.858,96.006,50.265,97.859,49.831,99.615,49.435,102.255,49.354,103.515,49.348,104.73,49.419,105.901,49.564,107.025,49.787,108.101,50.081,109.127,50.451,110.103,50.895,111.026,51.41,111.894,51.998,112.705,52.658,113.461,53.389,114.156,54.19,114.79,55.062,115.363,55.874,115.798,56.771,116.19,58.801,116.845,61.101,117.325,63.629,117.624,66.332,117.741,69.164,117.669,72.075,117.407,75.015,116.949,77.902,116.372,79.244,116.042,79.25113914518846,116.02994842287063,79.244,116.042,79.339,116.399,79.419,117.499,79.567,124.823,79.684,126.219,79.875,127.448,80.152,128.588,80.534,129.714,81.665,132.222,82.332,133.411,83.102,134.477,83.979,135.423,84.968,136.258,86.076,136.984,87.309,137.606,88.672,138.129,90.175,138.555,91.949,138.872,91.949,138.872,93.875,139.004,95.93,138.962,98.097,138.751,98.097,138.751,100.355,138.38,102.681,137.856,105.059,137.185,107.465,136.375,109.883,135.434,112.288,134.369,114.663,133.187,116.986,131.897,119.237,130.504,121.398,129.017,123.446,127.442,125.36,125.787,127.168,123.999,127.869,123.18,128.456,122.381,128.943,121.58,129.349,120.75,129.973,118.916,130.265,117.574,130.42,116.225,130.433,114.838,130.303,113.379,130.021,111.818,129.584,110.122,128.989,108.26,127.311,103.826,127.29746058034452,103.81664732613086,127.311,103.826,128.359,103.826,129.105,103.731,129.333,103.629,129.418,103.503,128.978,102.731,126.669,99.746,125.238,97.767,124.87,97.467,124.706,97.674,124.461,98.234,123.847,100.072,123.081,102.673,124.449,107.041,125.788,110.989,127.085,114.349,127.979,116.551,128.351,117.71375999999998,128.294,117.935,128.124,118.226,127.489,118.975,126.517,119.901,125.281,120.946,122.303,123.158,120.705,124.21,119.13,125.149,115.816,126.921,112.568,128.493,109.418,129.853,106.399,130.989,103.54,131.894,100.875,132.551,98.435,132.953,96.253,133.09,93.707,132.952,91.347,132.551,90.242,132.255,89.191,131.896,88.194,131.473,87.252,130.991,86.368,130.449,85.543,129.847,84.778,129.188,84.078,128.472,83.441,127.698,82.871,126.871,82.367,125.988,81.935,125.053,81.424,123.698,81.133,122.493,81.003,121.096,80.983,119.167,80.983,119.167,81.031,117.562,81.149,116.106,81.331,114.858,82.006,112.314,82.006,112.314,82.144,111.257,82.101,110.921,81.983,110.716,81.788,110.643,80.206,111.093,77.908,111.664,76.147,112.006,74.187,112.228,71.705,112.353,68.385,112.408,64.761,112.413,62.562,112.325,61.17,112.09,59.968,111.652,58.483,110.962,57.142,110.209,55.949,109.395,54.901,108.518,54,107.581,53.245,106.584,52.638,105.526,52.175,104.405,51.811,103.065,51.595,101.665,51.523,100.218,51.597,98.75,51.812,97.281,52.167,95.83,52.659,94.416,53.289,93.063,54.291,91.147,54.782,90.088,54.878,89.571,54.697,89.281,54.519,89.215],[106.863,41.599,106.385,42.623,105.617,44.646,105.108,46.14,104.881,47.071,104.906,47.672,105.588,49.148,105.912,50.376,106.563,53.166,107.645,56.922,108.893,60.789,110.048,63.911,111.016,66.371,111.419,67.64,111.279,68.068,110.899,68.553,110.328,69.055,109.629,69.541,108.848,69.978,108.045,70.33,107.274,70.565,106.589,70.648,106.004,70.593,105.371,70.442,104.021,69.885,102.667,69.042,101.429,67.977,100.41,66.822,100.052,66.282,99.776,65.718,99.567,65.098,99.413,64.385,98.76,57.97,98.113,53.677,97.233,49.465,96.081,45.131,95.48,43.062,93.379,46.882,93.379,46.882,93.036,47.778,92.997,48.148,93.033,48.527,94.188,52.538,94.188,52.538,94.698,54.823,94.929,57,94.992,59.723,94.911,62.792,94.781,64.021,94.575,65.111,94.283,66.106,93.894,67.055,93.397,68.006,92.779,69.001,91.89,70.087,90.814,70.97,89.607,71.632,88.318,72.066,87.005,72.257,85.717,72.192,84.508,71.86,83.949,71.589,83.429,71.246,82.406,70.316,81.604,69.238,81.022,67.98,80.652,66.516,80.491,64.813,80.532,62.839,80.771,60.564,81.204,57.961,81.987,53.695,82.349,51.225,82.388,50.502,82.34,50.039,82.211,49.769,82.006,49.63,81.693,49.583,81.246,49.609,80.179,49.848,79.456,50.164,78.877,50.687,78.283,51.618,77.512,53.151,76.578,55.422,75.719,58.288,74.844,62.113,73.86,67.254,73.378,69.441,72.799,71.248,72.129,72.663,71.764,73.221,71.377,73.68,70.974,74.036,70.551,74.29,70.113,74.44,69.659,74.487,69.188,74.429,68.704,74.263,68.206,73.993,67.696,73.612,66.929,72.862,66.273,71.979,65.722,70.944,65.267,69.729,64.901,68.313,64.617,66.67,64.406,64.777,64.132,60.266,63.995,59.031,63.908,58.748,63.797,58.64,63.654,58.676,63.478,58.828,63.194,59.304,63.023,60.185,62.945,61.693,62.933,64.059,62.977,66.68,63.128,68.501,63.465,70.08,64.072,71.977,64.982,74.382,65.893,76.278,65.893,76.278,66.811,77.672,67.273,78.183,67.74,78.572,68.12,78.784,68.12,78.784,68.578,78.945,69.614,79.111,70.667,79.06,71.144,78.951,71.553,78.782,72.181,78.304,72.776,77.547,73.343,76.495,73.885,75.13,74.414,73.434,74.933,71.384,76.655,62.676,77.376,59.709,78.065,57.527,78.374,56.812,78.646,56.392,78.924,56.174,79.132,56.151,79.271,56.316,79.343,56.663,79.276,57.878,78.593,61.39,78.358,63.147,78.217,64.934,78.17,66.699,78.215,68.387,78.356,69.943,78.592,71.312,78.92,72.436,79.286,73.246,79.765,74.065,80.334,74.868,80.966,75.628,81.64,76.317,82.329,76.911,83.012,77.38,83.662,77.699,84.557,77.966,85.461,78.101,86.371,78.109,87.275,78,88.172,77.775,89.048,77.44,89.901,77.001,90.72,76.465,91.5,75.835,92.233,75.116,92.911,74.315,93.527,73.436,94.076,72.486,94.546,71.47,94.934,70.392,95.585,68.007,95.76,67.629,95.902,67.492,96.048,67.593,96.234,67.875,97.311,70.451,98.229,71.943,99.345,73.254,100.623,74.364,102.03,75.242,103.529,75.864,105.085,76.203,105.875,76.26,106.663,76.235,108.203,75.971,108.892,75.742,109.53,75.447,110.118,75.082,110.655,74.649,111.142,74.145,111.581,73.57,111.973,72.921,112.319,72.197,112.872,70.524,113.25,68.535,113.457,66.226,113.492,63.776,113.418,62.722,113.27,61.727,113.042,60.743,112.724,59.728,111.241,56.042,110.662,54.333,110.203,52.783,110.017,51.872,110.00520589063491,51.86422304674804,110.017,51.872,110.143,51.846,110.5,52.003,113.852,54.164,113.852,54.164,120.056,57.829,120.056,57.829,124.112,60.417,127.943,62.988,130.619,64.934,134.751,68.419,136.522,70.059,138.106,71.643,139.507,73.175,140.736,74.664,141.8,76.117,142.703,77.542,143.573,79.14,144.338,80.781,144.997,82.454,145.552,84.154,146,85.871,146.341,87.602,146.576,89.338,146.705,91.073,146.727,92.797,146.642,94.506,146.449,96.192,146.147,97.848,145.736,99.467,145.218,101.042,144.591,102.564,142.883,105.874,142.572,106.647,142.873,106.383,143.41,105.669,144.909,103.373,146.487,100.706,147.557,98.619,148.524,96.048,148.871,94.868,149.136,93.701,149.457,91.26,149.547,88.399,149.495,86.434,149.344,84.542,149.088,82.713,148.726,80.944,148.249,79.223,147.658,77.548,146.946,75.909,146.111,74.298,145.147,72.711,144.051,71.139,142.819,69.575,141.446,68.012,139.931,66.443,138.268,64.86,136.452,63.258,134.479,61.628,132.108,59.86,132.108,59.86,128.67,57.414,128.67,57.414,125.471,55.206,123.815,54.151,122.504,53.471,120.181,52.149,115.547,49.349,113.254,47.715,111.043,45.896,109.209,44.151,108.524,43.387,107.323,41.808,107.042,41.595,106.863,41.599],[118.651,36.974,152.132,37.324,152.1418948974764,37.31410507780469,152.132,37.324,152.482,70.797,175.908,94.71006857142856,175.908,94.71006857142856,175.908,94.71006857142856,175.92199576157998,94.71006844825182,175.908,94.71006857142856,152.481,118.625,152.132,152.096,152.14189519617244,152.10589552250553,152.132,152.096,118.651,152.444,94.732,175.866,94.732,175.866,94.732,175.866,94.7320001431074,175.879992750013,94.732,175.866,70.811,152.443,37.333,152.096,37.323104492790286,152.10589581505536,37.333,152.096,36.985,118.622,13.558,94.71006857142856,13.558,94.71006857142856,13.558,94.71006857142856,13.544004082860415,94.71006917357346,13.558,94.71006857142856,36.986,70.793,37.333,37.324,37.32310421881203,37.31410506860349,37.333,37.324,70.814,36.974,94.732,13.553,94.732,13.553,94.732,13.553,94.73199985377794,13.53900725950539,94.732,13.553,118.651,36.974],[94.735,9.673,69.668,34.214,34.59,34.577,34.221,69.651,34.221,69.651,34.221,69.651,9.675,94.707,34.221,119.768,34.585,154.837,69.668,155.206,69.668,155.206,69.668,155.206,94.728,179.746,119.798,155.206,154.875,154.842,155.244,119.769,155.244,119.769,155.244,119.769,179.791,94.714,155.244,69.65,154.88,34.582,119.798,34.214,119.798,34.214,119.798,34.214,94.735,9.673]];

paths=[[6.694,3.269,6.701222121627256,3.2641938122366128,6.694,3.269,6.775,3.85,6.89,3.979,7.117,4.058,7.359,4.055,7.51,3.97,7.768,3.437,7.891,3.409,8.105,3.483,8.289,3.612,8.341,3.7288611111111107,8.064,4.249,8.081,4.417,8.219,4.617,8.418,4.756,8.59,4.775,9.109,4.5,9.226,4.552,9.354,4.732,9.428,4.945,9.4,5.073,8.874,5.326,8.787,5.476,8.783,5.718,8.861,5.946,8.985,6.064,9.571,6.143,9.636,6.255,9.633,6.479,9.566,6.698,9.471,6.783,8.894,6.677,8.736,6.748,8.59,6.94,8.518,7.171,8.553,7.339,8.977,7.75,8.966,7.875,8.831,8.053,8.648,8.19,8.521,8.204,8.114,7.779,7.945,7.746,7.717,7.816,7.522,7.958,7.45,8.115,7.555,8.698,7.47,8.793,7.252,8.857,7.028,8.864,6.919,8.799,6.838,8.215,6.724,8.089,6.493,8.01,6.255,8.014,6.104,8.095,5.846,8.628,5.719,8.656,5.509,8.582,5.323,8.452,5.272,8.335,5.55,7.816,5.533,7.648,5.391,7.448,5.196,7.309,5.024,7.29,4.505,7.569,4.389,7.518,4.258,7.331,4.185,7.118,4.214,6.992,4.74,6.739,4.827,6.589,4.831,6.347,4.753,6.119,4.625,6.001,4.043,5.922,3.977,5.808,3.981,5.586,4.047,5.369,4.143,5.286,4.719,5.388,4.877,5.317,5.024,5.125,5.095,4.894,5.06,4.726,4.637,4.316,4.648,4.19,4.783,4.012,4.962,3.875,5.093,3.861,5.496,4.286,5.665,4.323,5.896,4.252,6.092,4.107,6.161,3.95,6.059,3.37,6.146,3.274,6.359,3.208,6.586,3.205,6.694,3.269,6.701222121627256,3.2641938122366128,6.694,3.269],[10.331,3.625,10.331975459870971,3.627196800713035,10.331,3.625,10.008,3.724,9.658,3.653,9.264,3.326,9.008,2.889,8.997,2.532,9.148,2.229,9.579,1.72,9.681,1.469,9.588,1.203,9.213,0.891,8.766,0.697,8.484,0.734,8.307,0.936,8.046,1.549,7.845,1.817,7.519,1.971,7.01,1.935,6.542,1.731,6.323,1.448,6.267,1.115,6.316,0.45,6.254,0.19,6.019,0.027,5.534,-0.005,5.059,0.099,4.853,0.296,4.832,0.562,4.98,1.21,4.973,1.546,4.798,1.863,4.37,2.133,3.87,2.242,3.523,2.14,3.284,1.905,2.935,1.34,2.727,1.166,2.442,1.171,2.032,1.432,1.71,1.795,1.657,2.077,1.796,2.304,2.3,2.741,2.493,3.017,2.535,3.374,2.345,3.85,2.007,4.23,1.669,4.348,1.335,4.299,0.72,4.048,0.449,4.028,0.221,4.2,0.044,4.653,-0.004,5.135,0.121,5.392,0.366,5.498,1.03,5.558,1.348,5.666,1.593,5.929,1.717,6.424,1.667,6.93,1.463,7.229,1.166,7.382,0.52,7.542,0.292,7.682,0.207,7.956,0.327,8.427,0.573,8.845,0.827,8.98,1.086,8.919,1.657,8.577,1.98,8.479,2.333,8.549,2.723,8.875,2.98,9.316,2.99,9.676,2.84,9.973,2.412,10.483,2.309,10.733,2.403,11.003,2.774,11.311,3.222,11.509,3.503,11.469,3.681,11.266,3.942,10.656,4.144,10.387,4.472,10.232,4.976,10.267,5.443,10.47,5.664,10.758,5.721,11.087,5.671,11.752,5.733,12.016,5.969,12.179,6.453,12.207,6.928,12.104,7.135,11.907,7.156,11.641,7.011,10.993,7.015,10.654,7.189,10.341,7.621,10.07,8.117,9.96,8.464,10.062,8.702,10.297,9.053,10.866,9.261,11.04,9.545,11.032,9.956,10.774,10.278,10.408,10.33,10.129,10.192,9.899,9.691,9.461,9.498,9.184,9.452,8.828,9.643,8.356,9.98,7.973,10.319,7.854,10.653,7.904,11.267,8.154,11.539,8.174,11.766,8.003,11.943,7.553,11.992,7.067,11.866,6.811,11.621,6.708,10.958,6.648,10.638,6.539,10.394,6.274,10.271,5.783,10.32,5.271,10.523,4.978,10.822,4.82,11.468,4.664,11.699,4.521,11.781,4.25,11.66,3.779,11.415,3.358,11.161,3.223,10.902,3.284,10.331,3.625,10.331975459870971,3.627196800713035,10.331,3.625]];


paths=[[14.853,7.621,14.852888903534444,7.620204920259664,14.853,7.621,16.055,7.502,17.343,7.459,18.93,7.544,20.481,7.787,22.001,8.196,23.49,8.768,24.784,9.417,25.708,10.08,26.26,10.756,26.4,11.096,26.446,11.439,26.328,11.875,25.969,12.262,25.369,12.6,24.531,12.889,22.669,13.224,20.414,13.337,19.131,13.277,17.756,13.104,16.289,12.815,14.73,12.409,12.988,11.803,11.743,11.143,11.309,10.791,10.997,10.426,10.814,10.045,10.751,9.655,10.873,9.214,11.239,8.806,11.856,8.436,12.715,8.105,13.742,7.822,14.853,7.621,14.852888903534444,7.620204920259664,14.853,7.621],[4.582,-0.004,3.516,3.9,4.075,4.318,4.726,4.612,5.467,4.789,6.297,4.849,7.285,4.783,7.298486878818172,4.772969383686575,7.285,4.783,6.377,7.206,5.601,9.739,4.955,12.375,4.444,15.109,3.964,19.056,3.516,24.514,3.428,25.038,3.227,25.454,2.917,25.763,2.495,25.967,0.578,26.231,0.322,26.391,0.14,26.767,0.03,27.361,-0.005,28.169,0.027,28.368,5.637,28.255,13.441,28.206,12.677,25.311,12.13,22.56,11.802,19.95,11.692,17.474,11.724,15.95,11.822,15.184,11.81448587360048,15.169300036272148,11.822,15.184,12.86,15.749,13.716,16.379,14.397,17.071,14.89,17.824,15.157,18.447,15.369,19.223,15.521,20.144,15.807,23.926,16.015,25.624,16.272,26.516,16.696,27.29,17.279,27.943,18.028,28.48,18.939,28.897,20.012,29.194,21.251,29.37,22.648,29.43,24.861,29.303,27.525,28.919,28.573,28.689,29.555,28.385,30.472,28.004,31.325,27.549,32.113,27.016,32.836,26.409,33.497,25.724,34.093,24.966,34.792,23.832,35.293,22.721,35.597,21.626,35.696,20.549,35.65,20.03,35.504,19.538,35.268,19.069,34.935,18.627,34.449,18.178,33.887,17.857,33.246,17.666,32.534,17.602,31.452,17.722,30.267,18.082,29.048,18.598,27.955,19.176,26.988,19.815,26.148,20.511,25.534,21.153,25.096,21.771,24.831,22.361,24.742,22.93,24.824,23.376,25.216,24.006,25.813,24.459,26.615,24.727,27.622,24.819,28.647,24.738,31.559,24.174,31.814,24.227,31.9,24.384,31.757,24.705,31.328,25.06,30.612,25.455,29.607,25.882,28.454,26.288,27.364,26.577,26.331,26.75,25.358,26.81,24.326,26.683,23.92,26.524,23.59,26.302,23.329,26.018,23.147,25.669,23.038,25.254,22.999,24.78,23.066,23.859,23.475,21.478,23.546,20.716,23.468,20.055,23.239,19.454,22.857,18.913,22.319,18.428,21.43,17.903,20.265,17.415,18.825,16.967,17.178,16.574,17.158309798725433,16.57082283079278,17.178,16.574,18.877,16.72,20.55,16.769,22.924,16.653,25.104,16.3,27.092,15.717,28.88,14.899,29.792,14.344,30.575,13.745,31.242,13.098,31.786,12.403,32.21,11.658,32.51,10.867,32.693,10.026,32.753,9.141,32.654,7.993,32.362,6.962,31.871,6.048,31.182,5.253,30.691,4.847,30.143,4.493,28.877,3.95,27.387,3.625,25.672,3.516,21.523,3.749,16.666,3.964,14.99,3.914,13.421,3.77,11.957,3.527,10.599,3.184,9.059,2.639,7.542,1.926,6.05,1.044,4.582,-0.004]];
scale=20;
move=10;

var step=1*scale; // 
var maxr=5*scale;
var dstep=0.00001*scale;
var dstep2=0.1*scale;
// segmentation
var segs=[];
var c = $("mycanv");
var ctx = c.getContext("2d");
ctx.strokeStyle = "#0000ff";
var s=0;
function segmentation(path,rev){
	ctx.beginPath();
	var x1,y1,x2,y2;
	PL=path.length/2;
	L=0;
	for (var p=0;p<PL;p++){
		i=p;
		ii=p+1;
		if (ii>=PL)ii=0;

		if (rev){
			i=PL-i-1;
			ii=PL-ii-1;
		}
		x2=path[i*2+0]*scale+move;
		y2=path[i*2+1]*scale+move;
		if (p>0){
			var OL=L;
			if (p>1){ // if last L ok, interpolate from previous vector, but on same position
				opx=px;
				opy=py;
			}
			L=(sqrt(sqr(x2-x1)+sqr(y2-y1)));
			if (L>0){
				ctx.moveTo(x1,y1);
				ctx.lineTo(x2,y2);
				vx=(x2-x1)/L;
				vy=(y2-y1)/L;
				L=Math.floor(L/step)+1;
				dx=(x2-x1)/L;
				dy=(y2-y1)/L;
				
				for (var j=0;j<L;j++){
					px=x1+(j+.5)*dx;
					py=y1+(j+.5)*dy;
					//ctx.beginPath();
					//ctx.moveTo(px,py);
					//ctx.arc(px,py,1,0,2*Math.PI);
					//ctx.stroke();
					if (OL>0){ // if last L ok, interpolate from previous vector, but on same position
							opx=(px-opx);
							opy=(py-opy);
							OL=sqrt(sqr(opx)+sqr(opy));
							NL = Math.floor(OL / step) + 1;
							ndx = (opx) / NL;
							ndy = (opy) / NL;
							opx/=OL;
							opy/=OL;
							
							//for (var nj = NL; nj >0; nj--) {
							nj=1;
							segs.push([px-(nj-0.5)*ndx, py-(nj-0.5)*ndy, s-1, 0, 0, 0, 0, opx, opy, 0, 0]); //
							//}
							if (p==PL)return;
							OL=0; 						
						}
					segs.push([px,py,s,0,0,0,0,vx,vy,0,0]); // last 3 is to store data
				}
				s++;
				x1=x2;
				y1=y2;
			}
		} else { 
			x1=x2;
			y1=y2;
			segs.push([x1,y1,-1,x1,y1,0,0,0,0,0,0]); // last 3 is to store data
		}
	}
	ctx.stroke();
}

for (var pi=0;pi<paths.length;pi++){
	segmentation(paths[pi],1);
}
var ms = performance.now();

// create toolpath
// s= number of line
ctx.strokeStyle = "#00ff00";
var n=0;
v=90;
var gc="G0 Z5 F10\nG1 F10\nG64 P0.001\nM3\nT1\n";
ve=1/Math.tan(v*Math.PI/360);
var jj,seg2,seg1,mr2;
for (var i=0;i<segs.length;i++){
	mr2=0; // d squared
	seg1=segs[i];
	if (seg1[2]==-1){
		// move
		continue;
	}
	if (seg1[6]>0)continue;
	var cx,cy,cz,ox,oy;
	found=0;
	var jj=-1;
	var ks=0;
	for (var j=0;j<segs.length;j++){
		seg2=segs[j];
		if (seg1[2]==seg2[2])continue; // if on same line dont do it
		//seg2[9]=sqr(seg1[0]-seg2[0])+sqr(seg1[1]-seg2[1]);
		//if (ks<seg2[9])ks=seg2[9];
	}
	var r=maxr;
	//var r=sqrt(ks);
	//if (r>maxr)r=maxr;
	while (r>0){
		ox=seg1[0]-r*seg1[8];
		oy=seg1[1]+r*seg1[7];
		k2=sqr(r);
		var ok=1;
		var rmin=100000;
		for (var j=0;j<segs.length;j++){
			seg2=segs[j];
			if ((seg1[2]==-1) || (seg1[2]==seg2[2]) )continue; // if on same line dont do it
			n++;
			// find the distance to the seg2
			// simple way 
			 //r2=sqr(ox-seg2[0])+sqr(oy-seg2[1]);
			// correct way
			///*
			r3=sqr(ox-seg2[0])+sqr(oy-seg2[1])-k2;
			if (r3<=0){
				ok=0;
				break;
			}
			if (r3<rmin){
				jj=j;
				rmin=r3;
			}
		}
		if (ok)break;
		lr=r;
		r=r-dstep2;
	}
	if (r<0)r=0.1;
	var fs=100;
	oz=-r*ve;
	seg1[3]=ox;
	seg1[4]=oy;
	seg1[5]=oz;
	seg1[6]=r;
	seg1[10]=fs;
	if (jj>=0){
		seg2=segs[jj];
		seg2[3]=ox;
		seg2[4]=oy;
		seg2[5]=oz;
		seg2[6]=r;
		seg2[10]=fs;
	}
	
}
function mround(x) {
    return (parseFloat(x*0.1)).toFixed(2);
}
ms = performance.now() - ms;
mss = "Real time:" + mround(ms);
console.log(mss);

ctx.beginPath();
for (var i=0;i<segs.length;i++){
	seg1=segs[i];
	cx=seg1[3];
	cy=seg1[4];
	r=seg1[6];
	if (seg1[2]==-1){
		ctx.moveTo(cx,cy);
		continue;
	}
	//ctx.lineTo(cx,cy);
	ctx.strokeStyle = "#cccccc";
	//r=1;
	ctx.moveTo(cx+r,cy);
	ctx.arc(cx,cy,r,0,2*Math.PI);
	ctx.moveTo(cx,cy);
}
ctx.stroke();

ctx.beginPath();
var cx0,cy0;
for (var i=0;i<segs.length;i++){
	seg1=segs[i];
	lx0=cx0;
	ly0=cy0;
	cx0=seg1[0];
	cy0=seg1[1];
	lx=cx;
	ly=cy;
	cx=seg1[3];
	cy=seg1[4];
	r=seg1[6];
	if (seg1[2]==-1){
		gc+="G0 Z2\n";
		gc+="G0 F6000 X"+mround(seg1[3])+" Y"+mround(-seg1[4])+"\n";
		gc+="G0 Z0\nG1 F1000\n";
		continue;
	}
	ctx.moveTo(lx,ly);
	ctx.lineTo(cx,cy);
	ctx.moveTo(lx0,ly0);
	ctx.lineTo(cx0,cy0);
	if (r>dstep)gc+="G1 F"+mround(seg1[10])+" X"+mround(seg1[3])+" Y"+mround(-seg1[4])+" Z"+mround(seg1[5])+"\n";
	ctx.strokeStyle = "#ff0000";
	//r=1;
	//ctx.moveTo(cx+r,cy);
	//ctx.arc(cx,cy,r,0,2*Math.PI);
	//ctx.moveTo(cx,cy);
}
ctx.stroke();

gc+="M2\n";
gcode.value=gc;


console.log(n);
</script>
</body>
